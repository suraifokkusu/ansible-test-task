# Развертывание веб-приложения с помощью Ansible и Docker

![Ansible](https://img.shields.io/badge/Ansible-2.10.8-blue?style=rounded)
![Docker](https://img.shields.io/badge/Docker-20.10.24-blue?style=rounded)
![NGINX](https://img.shields.io/badge/NGINX-1.27.2-red?style=rounded)
![PHP](https://img.shields.io/badge/PHP-7.4.33-purple?style=rounded)
![MySQL](https://img.shields.io/badge/MySQL-5.7.44-orange?style=rounded)

## Содержание

1. [Обзор](#обзор)  
2. [Требования](#требования)  
3. [Начало работы](#начало-работы)  
4. [Описание файлов](#описание-файлов)  
5. [Использование](#использование)
6. [Проверка работы приложения](#проверка-работы-приложения) 
7. [Устранение неполадок](#устранение-неполадок)  
8. [Заключение](#заключение)  

## Обзор

Этот проект направлен на развертывание докеризированного веб-приложения с использованием NGINX, PHP и MySQL на удалённом сервере с помощью Ansible и Docker Compose. Плейбук автоматизирует распределение необходимых файлов, генерирует конфигурационный файл NGINX и перезапускает службу NGINX при необходимости.


## Требования

- Установленный Ansible на вашем локальном компьютере.  
- Установленные Docker и Docker Compose на целевом сервере.  
- Доступ к целевому серверу (SSH).  
- Убедитесь, что у вас есть необходимые разрешения для выполнения команд Ansible и Docker.

## Начало работы

1. **Клонируйте репозиторий:**

   ```bash
   git clone <repository_url>
   cd project
   ```

2. **Настройка инвентаря:**

   Создайте файл инвентаря (например, `hosts.ini`) с данными вашего удалённого сервера:

   ```ini
   [web]
   your_server_ip ansible_ssh_user=your_username
   ```

3. **Измените переменные:**

   Отредактируйте файлы переменных в директории ролей по мере необходимости (например, `roles/mysql/vars/main.yml`).

4. **Запустите плейбук:**

   Выполните Ansible плейбук для развертывания приложения:

   ```bash
   ansible-playbook -i hosts.ini ansible/playbook.yml
   ```

## Описание файлов

- **playbook.yml**: Основной плейбук, который управляет развертыванием.  
- **roles/**: Содержит поддиректории для каждой роли (`php` и `mysql`), с задачами, шаблонами и переменными.  
- **docker-compose.yml**: Определяет службы для NGINX, PHP и MySQL.  
- **Dockerfile**: Собирает настраиваемый образ PHP с необходимыми расширениями.

## Использование

После завершения выполнения плейбука веб-приложение должно быть доступно по IP-адресу вашего сервера.

## Проверка работы приложения

После развертывания приложения, чтобы убедиться, что всё работает корректно, выполните следующие шаги:

1. Откройте веб-браузер и введите IP-адрес вашего сервера или доменное имя, чтобы получить доступ к главной странице приложения.
2. Проверьте доступность файла `index.php` и `info.php`, введя в адресной строке:
   ```
   http://<ваш_IP_адрес>/index.php
   http://<ваш_IP_адрес>/info.php
   ```
   IP, используемый в проекте: 
    ```
   http://85.209.9.128/index.php
   http://85.209.9.128/info.php
   ```
3. Убедитесь, что на странице отображается сообщение о успешном подключении к базе данных. Это означает, что приложение корректно взаимодействует с MySQL.
4. Проверьте логи NGINX на наличие ошибок:
   - Логи NGINX: `/var/log/nginx/error.log`

## Устранение неполадок

- Проверьте логи Ansible на наличие ошибок во время выполнения.  
- Убедитесь, что службы Docker работают с помощью `docker ps` на удалённом сервере.  
- Проверьте конфигурацию NGINX, заглянув в логи, расположенные в `/var/log/nginx/error.log`.
